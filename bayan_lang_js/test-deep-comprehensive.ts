#!/usr/bin/env ts-node

import { Lexer } from './src/lexer/lexer';
import { Parser } from './src/parser/parser';
import { Compiler } from './src/compiler/compiler';

console.log('๐งช ุงูุงุฎุชุจุงุฑ ุงูุนููู ุงูุดุงูู ููุบุฉ ุงูุจูุงู\n');
console.log('='.repeat(80));

interface TestCase {
  category: string;
  name: string;
  code: string;
  shouldCompile?: boolean;
}

const testCases: TestCase[] = [
  // ============================================================================
  // 1. ุงูุจุฑูุฌุฉ ุงูุฅุฌุฑุงุฆูุฉ (Procedural Programming)
  // ============================================================================
  {
    category: 'ุฅุฌุฑุงุฆูุฉ',
    name: 'ูุชุบูุฑุงุช ูุชุนุฏุฏุฉ',
    code: `
ูุชุบูุฑ ุณ = 1ุ ุต = 2ุ ุน = 3;
ุซุงุจุช ุซุงุจุช1 = 10ุ ุซุงุจุช2 = 20;
ุฏุน ุฏุน1 = "ุฃ"ุ ุฏุน2 = "ุจ";
`
  },
  {
    category: 'ุฅุฌุฑุงุฆูุฉ',
    name: 'ุนูุงูู ุงูุฒูุงุฏุฉ ูุงูููุตุงู',
    code: `
ูุชุบูุฑ ุณ = 0;
ุณ++;
++ุณ;
ุณ--;
--ุณ;
ูุชุบูุฑ ุต = ุณ++;
ูุชุบูุฑ ุน = ++ุณ;
`
  },
  {
    category: 'ุฅุฌุฑุงุฆูุฉ',
    name: 'ุญููุงุช ูุชุฏุงุฎูุฉ',
    code: `
ููู (ูุชุบูุฑ ุท = 0; ุท < 3; ุท++) {
  ููู (ูุชุบูุฑ ุฌ = 0; ุฌ < 3; ุฌ++) {
    ุงุทุจุน(ุท * ุฌ);
  }
}
`
  },
  {
    category: 'ุฅุฌุฑุงุฆูุฉ',
    name: 'ุดุฑูุท ูุชุฏุงุฎูุฉ',
    code: `
ูุชุบูุฑ ุณ = 5;
ุงุฐุง (ุณ > 0) {
  ุงุฐุง (ุณ < 10) {
    ุงุทุจุน("ุจูู 0 ู 10");
  } ูุงูุง {
    ุงุทุจุน("ุฃูุจุฑ ูู 10");
  }
} ูุงูุง {
  ุงุทุจุน("ุณุงูุจ");
}
`
  },
  {
    category: 'ุฅุฌุฑุงุฆูุฉ',
    name: 'ูุตูููุงุช ููุนุงูุฌุชูุง',
    code: `
ูุชุบูุฑ ุฃุฑูุงู = [1ุ 2ุ 3ุ 4ุ 5];
ูุชุบูุฑ ูุฌููุน = 0;
ููู (ูุชุบูุฑ ุท = 0; ุท < ุฃุฑูุงู.ุทูู; ุท++) {
  ูุฌููุน = ูุฌููุน + ุฃุฑูุงู[ุท];
}
`
  },
  {
    category: 'ุฅุฌุฑุงุฆูุฉ',
    name: 'ูุงุฆูุงุช ููุนุงูุฌุชูุง',
    code: `
ูุชุบูุฑ ุดุฎุต = {
  ุงุณู: "ุฃุญูุฏ"ุ
  ุนูุฑ: 25ุ
  ูุฏููุฉ: "ุงูุฑูุงุถ"
};
ุงุทุจุน(ุดุฎุต.ุงุณู);
ุดุฎุต.ุนูุฑ = 26;
`
  },
  {
    category: 'ุฅุฌุฑุงุฆูุฉ',
    name: 'ุฏูุงู ูุชุฏุงุฎูุฉ',
    code: `
ุฏุงูุฉ ุฎุงุฑุฌูุฉ(ุณ) {
  ุฏุงูุฉ ุฏุงุฎููุฉ(ุต) {
    ุงุฑุฌุน ุณ + ุต;
  }
  ุงุฑุฌุน ุฏุงุฎููุฉ(10);
}
ูุชุบูุฑ ูุชูุฌุฉ = ุฎุงุฑุฌูุฉ(5);
`
  },
  {
    category: 'ุฅุฌุฑุงุฆูุฉ',
    name: 'ุฏูุงู ุณูููุฉ',
    code: `
ูุชุบูุฑ ุฌูุน = (ุฃุ ุจ) => ุฃ + ุจ;
ูุชุบูุฑ ูุฑุจุน = ุณ => ุณ * ุณ;
ูุชุบูุฑ ุงุทุจุน_ุดูุก = () => ุงุทุจุน("ูุฑุญุจุง");
`
  },
  {
    category: 'ุฅุฌุฑุงุฆูุฉ',
    name: 'ูุนุงููุงุช ุงูุชุฑุงุถูุฉ',
    code: `
ุฏุงูุฉ ุชุญูุฉ(ุงุณู = "ุถูู"ุ ุฑุณุงูุฉ = "ูุฑุญุจุง") {
  ุงุฑุฌุน ุฑุณุงูุฉ + " " + ุงุณู;
}
`
  },
  {
    category: 'ุฅุฌุฑุงุฆูุฉ',
    name: 'ูุนุงููุงุช rest',
    code: `
ุฏุงูุฉ ุฌูุน_ูู(...ุฃุฑูุงู) {
  ูุชุบูุฑ ูุฌููุน = 0;
  ููู (ูุชุบูุฑ ุท = 0; ุท < ุฃุฑูุงู.ุทูู; ุท++) {
    ูุฌููุน = ูุฌููุน + ุฃุฑูุงู[ุท];
  }
  ุงุฑุฌุน ูุฌููุน;
}
`
  },

  // ============================================================================
  // 2. ุงูุจุฑูุฌุฉ ุงููุงุฆููุฉ (Object-Oriented Programming)
  // ============================================================================
  {
    category: 'ูุงุฆููุฉ',
    name: 'ุตูู ุจุณูุท',
    code: `
ุตูู ุดุฎุต {
  ููุดุฆ(ุงุณูุ ุนูุฑ) {
    ูุฐุง.ุงุณู = ุงุณู;
    ูุฐุง.ุนูุฑ = ุนูุฑ;
  }
  
  ุฏุงูุฉ ุชุญูุฉ() {
    ุงุฑุฌุน "ูุฑุญุจุงุ ุฃูุง " + ูุฐุง.ุงุณู;
  }
}
`
  },
  {
    category: 'ูุงุฆููุฉ',
    name: 'ูุฑุงุซุฉ',
    code: `
ุตูู ุญููุงู {
  ููุดุฆ(ุงุณู) {
    ูุฐุง.ุงุณู = ุงุณู;
  }
  
  ุฏุงูุฉ ุตูุช() {
    ุงุฑุฌุน "ุตูุช";
  }
}

ุตูู ููุจ ููุชุฏ ุญููุงู {
  ุฏุงูุฉ ุตูุช() {
    ุงุฑุฌุน "ูุจุงุญ";
  }
}
`
  },
  {
    category: 'ูุงุฆููุฉ',
    name: 'ุตูู ูุฌุฑุฏ',
    code: `
ูุฌุฑุฏ ุตูู ุดูู {
  ูุฌุฑุฏ ุฏุงูุฉ ูุณุงุญุฉ();
  
  ุฏุงูุฉ ูุตู() {
    ุงุฑุฌุน "ุฃูุง ุดูู";
  }
}

ุตูู ูุฑุจุน ููุชุฏ ุดูู {
  ููุดุฆ(ุถูุน) {
    ูุฐุง.ุถูุน = ุถูุน;
  }
  
  ุฏุงูุฉ ูุณุงุญุฉ() {
    ุงุฑุฌุน ูุฐุง.ุถูุน * ูุฐุง.ุถูุน;
  }
}
`
  },
  {
    category: 'ูุงุฆููุฉ',
    name: 'getters ู setters',
    code: `
ุตูู ูุณุชุทูู {
  ููุดุฆ(ุนุฑุถุ ุงุฑุชูุงุน) {
    ูุฐุง._ุนุฑุถ = ุนุฑุถ;
    ูุฐุง._ุงุฑุชูุงุน = ุงุฑุชูุงุน;
  }
  
  ุงุญุตู ูุณุงุญุฉ() {
    ุงุฑุฌุน ูุฐุง._ุนุฑุถ * ูุฐุง._ุงุฑุชูุงุน;
  }
  
  ุงุญุตู ุนุฑุถ() {
    ุงุฑุฌุน ูุฐุง._ุนุฑุถ;
  }
  
  ุงุถุจุท ุนุฑุถ(ูููุฉ) {
    ูุฐุง._ุนุฑุถ = ูููุฉ;
  }
}
`
  },
  {
    category: 'ูุงุฆููุฉ',
    name: 'ุฎุตุงุฆุต ุซุงุจุชุฉ',
    code: `
ุตูู ุฑูุงุถูุงุช {
  ุซุงุจุช ุจุงู = 3.14159;
  
  ุซุงุจุช ุฏุงูุฉ ูุฑุจุน(ุณ) {
    ุงุฑุฌุน ุณ * ุณ;
  }
}
`
  },
  {
    category: 'ูุงุฆููุฉ',
    name: 'ูุญุฏุฏุงุช ุงููุตูู',
    code: `
ุตูู ุญุณุงุจ {
  ุฎุงุต ุฑุตูุฏ = 0;
  ุนุงู ุงุณู = "";
  ูุญูู ููุน = "ุชูููุฑ";
  
  ุนุงู ุฏุงูุฉ ุงูุฏุงุน(ูุจูุบ) {
    ูุฐุง.ุฑุตูุฏ = ูุฐุง.ุฑุตูุฏ + ูุจูุบ;
  }
  
  ุนุงู ุฏุงูุฉ ุงุญุตู_ุฑุตูุฏ() {
    ุงุฑุฌุน ูุฐุง.ุฑุตูุฏ;
  }
}
`
  },
  {
    category: 'ูุงุฆููุฉ',
    name: 'ูุงุฌูุฉ',
    code: `
ูุงุฌูุฉ ูุงุจู_ููุทุจุงุนุฉ {
  ุฏุงูุฉ ุงุทุจุน();
  ุฏุงูุฉ ุงุญุตู_ูุต();
}

ุตูู ูุณุชูุฏ ูููุฐ ูุงุจู_ููุทุจุงุนุฉ {
  ุฏุงูุฉ ุงุทุจุน() {
    ุงุทุจุน("ุทุจุงุนุฉ ุงููุณุชูุฏ");
  }
  
  ุฏุงูุฉ ุงุญุตู_ูุต() {
    ุงุฑุฌุน "ูุต ุงููุณุชูุฏ";
  }
}
`
  },

  // ============================================================================
  // 3. ุงูุจุฑูุฌุฉ ุงูููุทููุฉ (Logic Programming)
  // ============================================================================
  {
    category: 'ููุทููุฉ',
    name: 'ุญูุงุฆู ุจุณูุทุฉ',
    code: `
ุญูููุฉ ูุงูุฏ("ุฃุญูุฏ"ุ "ูุญูุฏ");
ุญูููุฉ ูุงูุฏ("ูุญูุฏ"ุ "ุนูู");
ุญูููุฉ ูุงูุฏ("ุนูู"ุ "ุญุณู");
`
  },
  {
    category: 'ููุทููุฉ',
    name: 'ููุงุนุฏ',
    code: `
ุญูููุฉ ูุงูุฏ("ุฃุญูุฏ"ุ "ูุญูุฏ");
ุญูููุฉ ูุงูุฏ("ูุญูุฏ"ุ "ุนูู");

ูุงุนุฏุฉ ุฌุฏ(ุณุ ุต) :- ูุงูุฏ(ุณุ ุน)ุ ูุงูุฏ(ุนุ ุต);
`
  },
  {
    category: 'ููุทููุฉ',
    name: 'ุงุณุชุนูุงูุงุช',
    code: `
ุญูููุฉ ูุงูุฏ("ุฃุญูุฏ"ุ "ูุญูุฏ");
ุงุณุชุนูุงู ูุงูุฏ("ุฃุญูุฏ"ุ ุุณ);
`
  },
  {
    category: 'ููุทููุฉ',
    name: 'assert ู retract',
    code: `
ุงุซุจุช ูุงูุฏ("ุฃุญูุฏ"ุ "ูุญูุฏ");
ุงุญุฐู ูุงูุฏ("ุฃุญูุฏ"ุ "ูุญูุฏ");
`
  },

  // ============================================================================
  // 4. ูุธุงู ุงูุฃููุงุน (Type System)
  // ============================================================================
  {
    category: 'ุฃููุงุน',
    name: 'ุฃููุงุน ุจุฏุงุฆูุฉ',
    code: `
ูุชุบูุฑ ุฑูู: ุฑูู = 5;
ูุชุบูุฑ ูุต: ูุต = "ูุฑุญุจุง";
ูุชุบูุฑ ููุทูู: ููุทูู = ุตุญูุญ;
ูุชุบูุฑ ุฃู_ุดูุก: ุฃู = "ุฃู ุดูุก";
`
  },
  {
    category: 'ุฃููุงุน',
    name: 'ุฏุงูุฉ ูุน ุฃููุงุน',
    code: `
ุฏุงูุฉ ุฌูุน(ุฃ: ุฑููุ ุจ: ุฑูู): ุฑูู {
  ุงุฑุฌุน ุฃ + ุจ;
}
`
  },
  {
    category: 'ุฃููุงุน',
    name: 'union types',
    code: `
ูุชุบูุฑ ูููุฉ: ุฑูู | ูุต = 5;
ูููุฉ = "ูุต";
`
  },
];

let passed = 0;
let failed = 0;
const failures: { category: string; name: string; error: string }[] = [];

for (const testCase of testCases) {
  try {
    const lexer = new Lexer(testCase.code);
    const tokens = lexer.tokenize();
    const parser = new Parser(tokens);
    const ast = parser.parse();
    
    // Try to compile
    if (testCase.shouldCompile !== false) {
      const compiler = new Compiler();
      const js = compiler.compile(ast);
    }
    
    console.log(`โ [${testCase.category}] ${testCase.name}`);
    passed++;
  } catch (error: any) {
    console.log(`โ [${testCase.category}] ${testCase.name}`);
    failures.push({
      category: testCase.category,
      name: testCase.name,
      error: error.message
    });
    failed++;
  }
}

console.log('\n' + '='.repeat(80));
console.log(`\n๐ ุงููุชุงุฆุฌ:`);
console.log(`   โ ูุฌุญ: ${passed}/${testCases.length}`);
console.log(`   โ ูุดู: ${failed}/${testCases.length}`);
console.log(`   ๐ ุงููุณุจุฉ: ${((passed / testCases.length) * 100).toFixed(1)}%`);

if (failures.length > 0) {
  console.log(`\nโ ุงููุดู:`);
  failures.forEach(f => {
    console.log(`   [${f.category}] ${f.name}:`);
    console.log(`      ${f.error}`);
  });
}

console.log('\n' + '='.repeat(80));

